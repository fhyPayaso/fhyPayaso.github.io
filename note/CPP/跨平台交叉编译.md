# 跨平台交叉编译


最近搞NDK相关的东西,又被C++的各种库搞的一头雾水, 重新梳理一下:

### 静态库和动态库

C++文件生成可执行文件之前的最后一步是链接操作, 这部分会把已经生成的.o文件和程序需要用到的库进行链接, 这里链接的库主要分为两种: 静态库和动态库

+ **静态库**: 在链接阶段将目标文件与所用到的库一起打包到可执行文件当中，主要的格式有 **.a (Linux/Mac)**、**.lib(Windows)**,其特点为:

	+ 静态库对函数库的链接是放在编译时期完成的。
	+ 程序在运行时与函数库再无瓜葛，移植方便。
	+ 浪费空间和资源，因为所有相关的目标文件与牵涉到的函数库被链接合成一个可执行文件。  


+ **动态库**: 静态库的主要问题有:1. 浪费空间以 2.三方库升级时可执行文件需要全部重新进行编译链接, 所以出现了一种动态库的方式，即在程序运行过程中才去链接第三方库，这样既节省资源又方便共享,但可执行文件需要在拥有库环境的情况下才能执行。动态库的主要的格式有 **.so (Linux)**、**.dylib(MacOS)**、**.dll(Windows)**, 其特点为


	+ 动态库把对一些库函数的链接载入推迟到程序运行的时期。　
	+ 可以实现进程之间的资源共享。（因此动态库也称为共享库）
	+ 将一些程序升级变得简单。
	+ 甚至可以真正做到链接载入完全由程序员在程序代码中控制（显示调用）。



### 交叉编译


在NDK开发过程中, 我们可能会用到一些C++库, 一般为了减少包大小, 都会使用动态库的链接方式, android平台的本质也是Linux，所以我们需要将第三方库在Mac/Windows平台上编译成android所需要的.so库


这里我们以assimp这个库为例, assimp是一个模型导入库, 在使用opengl加载obj文件的时候需要用到, 我们以MacOS为编译平台，主要的操作过程可以参考 [Assimp Android 编译](https://blog.csdn.net/weixin_33895475/article/details/87988259)

+ assimp地址: https://github.com/assimp/assimp/releases


在这个过程中有一点需要注意, 手动编译过程中的**DANDROID_ABI**决定了你生成的so对应的CPU架构,因为每一种CPU都有专属的二进制接口，所以实际开发时应该将各种CPU架构的so全部编译生成一遍,分别放入android项目的对应目录下。关于ABI请参考官方文档[Android ABI](https://developer.android.com/ndk/guides/abis)



























