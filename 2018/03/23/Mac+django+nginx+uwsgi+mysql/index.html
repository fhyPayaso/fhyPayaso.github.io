<!DOCTYPE html>
<html lang="cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Linux+django+nginx+uwsgi+mysql部署1.mac终端登录服务器ubuntu系统通过ssh连接 创建秘钥并下载 将ssh绑定到云主机(服务器需要关机) 将下载的ssh放入.ssh文件中 连接操作：      ssh ubuntu@123.206.21.17 出现了 Permission denied (publickey). 这是由于没有将公钥( publickey )">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux+django+nginx+uwsgi+mysql部署">
<meta property="og:url" content="http://example.com/2018/03/23/Mac+django+nginx+uwsgi+mysql/index.html">
<meta property="og:site_name" content="fhyPayaso&#39;s Blog">
<meta property="og:description" content="Linux+django+nginx+uwsgi+mysql部署1.mac终端登录服务器ubuntu系统通过ssh连接 创建秘钥并下载 将ssh绑定到云主机(服务器需要关机) 将下载的ssh放入.ssh文件中 连接操作：      ssh ubuntu@123.206.21.17 出现了 Permission denied (publickey). 这是由于没有将公钥( publickey )">
<meta property="og:locale">
<meta property="og:image" content="http://img.hellofhy.cn/18-3-23/61204845.jpg">
<meta property="og:image" content="http://img.hellofhy.cn/18-3-23/44651550.jpg">
<meta property="og:image" content="http://img.hellofhy.cn18-3-23/28161423.jpg">
<meta property="og:image" content="http://img.hellofhy.cn/18-3-23/85092329.jpg">
<meta property="og:image" content="http://img.hellofhy.cn/18-3-23/59100245.jpg">
<meta property="og:image" content="http://img.hellofhy.cn/18-3-23/55882304.jpg">
<meta property="og:image" content="http://img.hellofhy.cn/18-3-24/57137138.jpg">
<meta property="og:image" content="http://p0y1qzu73.bkt.clouddn.com/18-3-24/47870898.jpg">
<meta property="og:image" content="http://p0y1qzu73.bkt.clouddn.com/18-3-24/63838589.jpg">
<meta property="article:published_time" content="2018-03-22T16:00:00.000Z">
<meta property="article:modified_time" content="2020-12-29T08:29:27.419Z">
<meta property="article:author" content="fhyPayaso">
<meta property="article:tag" content="Django">
<meta property="article:tag" content="后端">
<meta property="article:tag" content="环境部署">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://img.hellofhy.cn/18-3-23/61204845.jpg">

<link rel="canonical" href="http://example.com/2018/03/23/Mac+django+nginx+uwsgi+mysql/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'cn'
  };
</script>

  <title>Linux+django+nginx+uwsgi+mysql部署 | fhyPayaso's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">fhyPayaso's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/03/23/Mac+django+nginx+uwsgi+mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="fhyPayaso">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fhyPayaso's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux+django+nginx+uwsgi+mysql部署
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-03-23 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-23T00:00:00+08:00">2018-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-29 16:29:27" itemprop="dateModified" datetime="2020-12-29T16:29:27+08:00">2020-12-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Django/" itemprop="url" rel="index"><span itemprop="name">Django</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Linux-django-nginx-uwsgi-mysql部署"><a href="#Linux-django-nginx-uwsgi-mysql部署" class="headerlink" title="Linux+django+nginx+uwsgi+mysql部署"></a>Linux+django+nginx+uwsgi+mysql部署</h1><h2 id="1-mac终端登录服务器ubuntu系统"><a href="#1-mac终端登录服务器ubuntu系统" class="headerlink" title="1.mac终端登录服务器ubuntu系统"></a>1.mac终端登录服务器ubuntu系统</h2><h4 id="通过ssh连接"><a href="#通过ssh连接" class="headerlink" title="通过ssh连接"></a>通过ssh连接</h4><ul>
<li>创建秘钥并下载</li>
<li>将ssh绑定到云主机(服务器需要关机)</li>
<li>将下载的ssh放入.ssh文件中</li>
<li>连接操作：</li>
</ul>
<pre><code>    ssh ubuntu@123.206.21.17</code></pre>
<p>出现了</p>
<pre><code>Permission denied (publickey).</code></pre>
<p>这是由于没有将公钥<code>( publickey )</code>  添加到本地 ssh 环境造成的，或者是由于多日未 进行<code>ssh</code> 登录操作，本地 <code>publickey</code> 失效造成的。添加一下即可。</p>
<pre><code>ssh-add ~/.ssh/ubuntu</code></pre>
<p>再次登录即可成功。</p>
<h2 id="2-装python环境"><a href="#2-装python环境" class="headerlink" title="2. 装python环境"></a>2. 装python环境</h2><ul>
<li><h4 id="更新软件列表和本地软件"><a href="#更新软件列表和本地软件" class="headerlink" title="更新软件列表和本地软件"></a>更新软件列表和本地软件</h4><pre><code>  sudo apt-get update //列表
  sudo apt-get upgrade //本地</code></pre>
</li>
</ul>
<ul>
<li><h4 id="安装多版本python"><a href="#安装多版本python" class="headerlink" title="安装多版本python"></a>安装多版本python</h4><ul>
<li><p>ubuntu自带python2.7版本</p>
<pre><code>  python --version</code></pre>
</li>
<li><p>安装python3</p>
<pre><code>  sudo apt-get install python3</code></pre>
</li>
<li><p>为python安装pip3</p>
<pre><code>  sudo apt install python3-pip</code></pre>
</li>
<li><p>更新一下pip版本</p>
<pre><code>  pip3 install --upgrade pip</code></pre>
<p>  但是这样操作你会发现pip3并没升级，还是8.1.1版本</p>
</li>
<li><p>用管理员权限更新即可</p>
<pre><code>  sudo -H pip3 install --upgrade pip</code></pre>
</li>
<li><p>查看当前pip3版本，应该是升级到9.0了</p>
<pre><code>  pip3 --version</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="3-配置虚拟环境"><a href="#3-配置虚拟环境" class="headerlink" title="3.配置虚拟环境"></a>3.配置虚拟环境</h2><ul>
<li><h4 id="安装虚拟环境"><a href="#安装虚拟环境" class="headerlink" title="安装虚拟环境"></a>安装虚拟环境</h4><pre><code>  sudo pip3 install virtualenv</code></pre>
<p>  <code>virtualenv</code>是虚拟环境安装包，创建虚拟环境可以更好地控制包的版本，包的版本不会因为2.1中的升级操作而升级，保证了项目的稳定性，不同虚拟环境之间的运行环境相互独立，互不干扰。</p>
</li>
<li><h4 id="管理我们的虚拟环境"><a href="#管理我们的虚拟环境" class="headerlink" title="管理我们的虚拟环境"></a>管理我们的虚拟环境</h4><pre><code>  sudo pip install virtualenvwrapper</code></pre>
<p>  <code>virtualenvwrapper</code>是<code>virtualenv</code>的扩展管理包，可以将所有的虚拟环境整合在一个目录下，使用前需要先进行以下配置</p>
<ul>
<li><p>创建虚拟环境管理目录</p>
<pre><code>  mkdir ~/.virtualenvs</code></pre>
</li>
<li><p>打开.bashrc</p>
<pre><code>  sudo vi ~/.bashrc</code></pre>
</li>
<li><p>在末尾添加以下内容</p>
<pre><code>  export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3 # 这句是为了防止环境变量$PATH中已有其它环境的python
  export WORKON_HOME=$HOME/.virtualenvs    # 放所有虚拟环境的地方
  source /usr/local/bin/virtualenvwrapper.sh</code></pre>
</li>
<li><p>启用配置文件</p>
<pre><code>  source ~/.bashrc</code></pre>
<p>  这里有个小坑，服务器长时间不操作会中断连接，报错</p>
<pre><code>  packet_write_wait: Connection to 123.206.21.17 port 22: Broken pipe</code></pre>
<p>  重新登录即可。</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><h4 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h4><pre><code>  mkvirtualenv env_mysite</code></pre>
<p>  创建虚拟环境需要联网,创建完虚拟环境之后会自动进入虚拟环境，可以通过命令行前括号判断是否在虚拟环境内。</p>
<p>  <img src="http://img.hellofhy.cn/18-3-23/61204845.jpg"></p>
<p>  常用操作</p>
<pre><code>  # 创建虚拟环境
  mkvirtualenv &lt;name&gt;
  # 列出所有虚拟环境
  workon TAB*2
  # 进入虚拟环境
  workon &lt;name&gt;
  # 退出虚拟环境
  deactivate
  # 删除虚拟环境
  rmvirtualenv &lt;name&gt;</code></pre>
</li>
<li><p>在虚拟环境中安装django包</p>
<pre><code>  pip install django</code></pre>
</li>
</ul>
<ul>
<li><p>这里安装一个tree包，可以清楚的看见文件接结构</p>
<pre><code>  sudo apt-get install tree</code></pre>
<p>  常用方法</p>
<pre><code>  # 查看当前目录下所有文件结构
  tree 
  # 只查看当前第一级的目录和文件
  tree -L 1</code></pre>
</li>
</ul>
<h2 id="4-用PyCharm将项目上传到服务器（本地）"><a href="#4-用PyCharm将项目上传到服务器（本地）" class="headerlink" title="4.用PyCharm将项目上传到服务器（本地）"></a>4.用PyCharm将项目上传到服务器（本地）</h2><ul>
<li><p>导出本机虚拟环境中的包</p>
<pre><code>  sudo pip freeze &gt; plist.txt</code></pre>
</li>
<li><p>利用PyCharm将代码上传到服务器</p>
</li>
</ul>
<p><img src="http://img.hellofhy.cn/18-3-23/44651550.jpg"><br>配置好连接域名和ssh</p>
<p><img src="http://img.hellofhy.cn18-3-23/28161423.jpg"><br>点击测试连接，如果没问题会有成功提示</p>
<p><img src="http://img.hellofhy.cn/18-3-23/85092329.jpg"><br>配置你本地上传路径和服务器上项目的路径</p>
<p><img src="http://img.hellofhy.cn/18-3-23/59100245.jpg"><br>选择你要上传的部分，右键上传即可</p>
<p><img src="http://img.hellofhy.cn/18-3-23/55882304.jpg"><br>再连接你的服务器，就会发现代码已经上传成功了。然后进入虚拟环境，进入项目目录，将之前导出的包安装。</p>
<pre><code>    pip install -r plist.txt</code></pre>
<ul>
<li><p>配置项目<code>settings.py    </code>，修改以下一项</p>
<pre><code>  ALLOWED_HOSTS = [&#39;*&#39;, ]</code></pre>
</li>
<li><p>在项目根目录文件夹下，在终端内（确保已进入虚拟环境）</p>
<pre><code>  python manage.py runserver 0:8000</code></pre>
<p>  访问8000端口检查django在服务器上是否能运行,成功说明django项目正常</p>
</li>
</ul>
<h2 id="5-uWSGI安装及配置"><a href="#5-uWSGI安装及配置" class="headerlink" title="5.uWSGI安装及配置"></a>5.uWSGI安装及配置</h2><ul>
<li><p>安装Python开发版本（因为安装uWSGI过程中需要编译）</p>
<pre><code>  sudo apt-get install python-dev</code></pre>
</li>
<li><p>安装gcc（因为安装uWSGI过程中需要C编译器）</p>
<pre><code>  sudo apt-get install gcc</code></pre>
</li>
<li><p>安装uWSGI</p>
<pre><code>  sudo pip install uwsgi</code></pre>
<p>  使用<code>uwsgi --version</code>命令查看版本号，确认已正确安装</p>
</li>
</ul>
<h2 id="6-配置uWSGI"><a href="#6-配置uWSGI" class="headerlink" title="6.配置uWSGI"></a>6.配置uWSGI</h2><ul>
<li><h4 id="打通uWSGI和Python"><a href="#打通uWSGI和Python" class="headerlink" title="打通uWSGI和Python"></a>打通uWSGI和Python</h4><ul>
<li><p>在项目根目录创建test.py文件，内容如下</p>
<pre><code>  def application(env, start_response):
  start_response(&#39;200 OK&#39;, [(&#39;Content-Type&#39;,&#39;text/html&#39;)])
  return [b&quot;Hello World&quot;]  # python3</code></pre>
</li>
<li><p>运行uWSGI（表示使用http协议，并使用8000端口，加载指定文件test.py）</p>
<pre><code>  uwsgi --http :8000 --wsgi-file test.py</code></pre>
</li>
<li><p>访问8000端口，若显示’Hello World’则表示运行正常，说明以下三个环节是相通的</p>
<pre><code>  web client &lt;-&gt; uWSGI &lt;-&gt; Python</code></pre>
</li>
</ul>
</li>
</ul>
<ul>
<li><h4 id="打通uWSGI和Django"><a href="#打通uWSGI和Django" class="headerlink" title="打通uWSGI和Django"></a>打通uWSGI和Django</h4><ul>
<li><p>在项目根目录创建文件uwsgi.ini，并写入以下内容</p>
<pre><code>  [uwsgi]
  # 使用nginx连接时使用
  # socket = 0:8001
  # 直接做web服务器使用
  http = 0:8080
  # 项目目录
  chdir = /home/ubuntu/projectname
  # 项目中wsgi.py文件的目录
  wsgi-file = /home/ubuntu/projectname/projectname/wsgi.py
  # 主进程
  master = true
  # 多进程&amp;多线程
  processes = 6
  threads = 2
  # .sock文件目录需与Nginx文件内的配置相同
  # socket = /home/python/Desktop/project_test/my_sock.sock
  # chmod-socket = 666
  # 以守护进程的方式启动
  vacuum = true
  # 存储pid进程
  pidfile=uwsgi.pid
  # 存储log日志
  daemonize=uwsgi.logv</code></pre>
</li>
<li><p>启动uWSGI服务</p>
<pre><code>  uwsgi --ini uwsgi.ini</code></pre>
</li>
<li><p>终端显示以下内容即代表开启成功</p>
<pre><code>  [uWSGI] getting INI configuration from my_uwsgi.ini</code></pre>
</li>
</ul>
</li>
</ul>
<pre><code>+ 访问8000端口，发现文字可以显示，图片不能显示，这是正常现象

    ![](http://img.hellofhy.cn/18-3-24/88907634.jpg)

+ 以上步骤说明以下三个环节是相通的

        web client &lt;-&gt; uWSGI &lt;-&gt; Django

+ 停止uWSGI服务

        uwsgi --stop uwsgi.pid</code></pre>
<h2 id="7-配置nginx"><a href="#7-配置nginx" class="headerlink" title="7.配置nginx"></a>7.配置nginx</h2><ul>
<li><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><pre><code>  sudo apt-get install nginx</code></pre>
<p>  Nginx安装成功后，系统会自动开启 Nginx 服务，默认使用80端口，打开浏览器并输入你服务器的IP地址，就可以看到 nginx 的测试页面.</p>
<p>  <img src="http://img.hellofhy.cn/18-3-24/57137138.jpg"></p>
<p>  说明以下两个环节是相通的</p>
<pre><code>  web client &lt;-&gt; the web server（Nginx）</code></pre>
</li>
</ul>
<ul>
<li><h4 id="配置ngxin"><a href="#配置ngxin" class="headerlink" title="配置ngxin"></a>配置ngxin</h4><ul>
<li><p>将<code>/etc/nginx/</code>目录下的<code>uwsgi_params</code>复制到项目文件夹，对此文件不做任何改动</p>
<pre><code>  cp /etc/nginx/uwsgi_params .</code></pre>
</li>
<li><p>在项目根目录创建文件<code>my_nginx.conf</code>，并写入以下内容</p>
<pre><code>  upstream django &#123;
  server    127.0.0.1:8001;
  # server      unix://home/python/Desktop/project_test/my_sock.sock;
  &#125;
  server &#123;
      listen      8000;  # 端口号
      server_name 127.0.0.1;  # 服务器 ip 或是域名(具体)
      charset     utf-8;  # 字符集
      # 最大上传限制
      # client_max_body_size 75M;
      location /media  &#123;
          alias /home/ubuntu/mysite/media_common;  # 媒体文件所在文件夹
      &#125;
      location /static &#123;
          alias /home/ubuntu/mysite/static_common;  # 静态文件所在文件夹
      &#125;
      # 将所有非媒体请求转到Django服务器上
      location / &#123;
          uwsgi_pass      django;  # 最上方已定义
          # 将所有参数都转到uwsgi下
          include         /home/ubuntu/mysite/uwsgi_params; # uwsgi_params的路径
      &#125;
  &#125;</code></pre>
<p>  这个配置文件表示将静态文件和媒体文件由Nginx处理，而其它的请求转入uWSGI处理</p>
</li>
</ul>
</li>
</ul>
<pre><code>+ 与Nginx配置目录建立软链接
    sudo ln -s /home/ubuntu/mysite/my_nginx.conf /etc/nginx/sites-enabled/

+ 这里注意把nginx的默认配置删掉
    rm /etc/nginx/sites-enabled/sites-available/defult

+ 创建静态文件与媒体文件存放目录
    sudo mkdir static_common
    sudo mkdir media_common

+ 如果出现权限问题，将权限改下就好
    chmod 777 static_common
    chmod 777 media_common

+ 修改项目`setting.py`,在最后添加
    STATIC_ROOT = os.path.join(BASE_DIR, &#39;static_common&#39;)
    MEDIA_ROOT = os.path.join(BASE_DIR, &#39;media_common&#39;)

+ 进入项目根目录，执行静态文件迁移命令
    python3 manage.py collectstatic</code></pre>
<h2 id="8-Nginx-uWSGI-Django"><a href="#8-Nginx-uWSGI-Django" class="headerlink" title="8.Nginx+uWSGI+Django"></a>8.Nginx+uWSGI+Django</h2><ul>
<li><h4 id="测试Nginx"><a href="#测试Nginx" class="headerlink" title="测试Nginx"></a>测试<code>Nginx</code></h4><ul>
<li><p>重启nginx服务</p>
<pre><code>  sudo /etc/init.d/nginx restart</code></pre>
</li>
<li><p>在浏览器内输入<code>&lt;YOUR_SERVER_IP&gt;:8000/static/admin/css/base.css</code>，检查是否能正常显示这个css文件</p>
<p><img src="http://p0y1qzu73.bkt.clouddn.com/18-3-24/47870898.jpg"></p>
</li>
<li><p>将一张测试图片<code>test.jpg</code>放入<code>media_common</code>文件夹中，在浏览器中输入<code>&lt;YOUR_SERVER_IP&gt;:8000/media/test.jpg</code>，如果出现403则将图片的权限改为666，成功显示图片</p>
<p><img src="http://p0y1qzu73.bkt.clouddn.com/18-3-24/63838589.jpg"></p>
</li>
</ul>
</li>
</ul>
<ul>
<li><h4 id="测试uWSGI"><a href="#测试uWSGI" class="headerlink" title="测试uWSGI"></a>测试uWSGI</h4><p>  在根目录运行之前的<code>test.py</code>,如果访问<code>&lt;YOUR_SERVBER_IP&gt;</code>显示hello world,说明uWSGI正常</p>
<pre><code>  uwsgi --socket :8001 --wsgi-file test.py</code></pre>
</li>
<li><h4 id="用UNIX-socket取代TCP-port"><a href="#用UNIX-socket取代TCP-port" class="headerlink" title="用UNIX socket取代TCP port"></a>用<code>UNIX socket</code>取代<code>TCP port</code></h4></li>
</ul>
<pre><code>+ 修改`my_nginx.conf`，最终版如下：


        upstream django &#123;
        # server    127.0.0.1:8001;
        server      unix://home/ubuntu/mysite/my_sock.sock;
        &#125;

        server &#123;
            listen      8000;  # 端口号
            server_name 127.0.0.1;  # 服务器 ip 或是域名(具体)
            charset     utf-8;  # 字符集
            # 最大上传限制
            # client_max_body_size 75M;
            location /media  &#123;
                alias /home/ubuntu/mysite/media_common;  # 媒体文件所在文件夹
            &#125;
            location /static &#123;
                alias /home/ubuntu/mysite/static_common;  # 静态文件所在文件夹
            &#125;
            # 将所有非媒体请求转到Django服务器上
            location / &#123;
                uwsgi_pass      django;  # 最上方已定义
                # 将所有参数都转到uwsgi下
                include         /home/ubuntu/mysite/uwsgi_params; # uwsgi_params的路径
            &#125;
        &#125;


+ 修改`my_uwsgi.ini`，最终版如下

        [uwsgi]
        # 使用nginx连接时使用
        # socket = 0:8001
        # 直接做web服务器使用
        # http = 0:8080
        # 项目目录
        chdir = /home/ubuntu/projectname
        # 项目中wsgi.py文件的目录
        wsgi-file = /home/ubuntu/projectname/projectname/wsgi.py
        # 主进程
        master = true
        # 多进程&amp;多线程
        processes = 6
        threads = 2
        # .sock文件目录需与Nginx文件内的配置相同
        socket = /home/home/ubuntu/mysite/my_sock.sock
        chmod-socket = 666
        # 以守护进程的方式启动
        vacuum = true
        # 存储pid进程
        pidfile=uwsgi.pid
        # 存储log日志
        daemonize=uwsgi.logv


+ 重启Nginx和uWSGI

        sudo /etc/init.d/nginx restart
        uwsgi --stop uwsgi.pid
        uwsgi --ini my_uwsgi.ini

+ 打开浏览器，地址栏输入网址`&lt;YOUR_SERVER_IP&gt;:8000`，查看图片和文字是否显示正常



+ 此时以下环节已全部打通

        web client &lt;-&gt; web server(nginx) &lt;-&gt; the socket &lt;-&gt; uwsgi &lt;-&gt; Django

+ 服务器开机自启

    修改`/etc/rc.local`，添加以下内容到`exit 0`之前

        /usr/local/bin/uwsgi --ini /home/ubuntu/uwsgi.ini</code></pre>
<h2 id="9-配置MySql"><a href="#9-配置MySql" class="headerlink" title="9.配置MySql"></a>9.配置MySql</h2><ul>
<li><h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><ul>
<li><p>安装mysql，安装过程中会让你设置密码</p>
<pre><code>  sudo apt-get install mysql-server    </code></pre>
</li>
<li><p>进入mysql</p>
<pre><code>  mysql -u root -p</code></pre>
</li>
</ul>
</li>
</ul>
<pre><code>    出现下图说明进入成功

    ![](http://img.hellofhy.cn/18-3-24/3056630.jpg)

+ 展示数据库内容

        show database;

    ![](http://img.hellofhy.cn/18-3-24/69529505.jpg)</code></pre>
<ul>
<li><h4 id="配置mysql能被远程访问"><a href="#配置mysql能被远程访问" class="headerlink" title="配置mysql能被远程访问"></a>配置mysql能被远程访问</h4></li>
</ul>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li><p>新建文件</p>
<pre><code>  vim test.py</code></pre>
</li>
</ul>
<ul>
<li><p>当前路径下新建文件夹</p>
<pre><code>  mkdir &lt;文件夹名&gt;</code></pre>
</li>
<li><p>解压zip</p>
<pre><code>  sudo unzip FileName.zip</code></pre>
</li>
<li><p>删除文件</p>
<pre><code>  rm &lt;文件夹名&gt;</code></pre>
</li>
<li><p>重命名文件</p>
<pre><code>  mv oldname newname</code></pre>
</li>
<li><p>vim常用操作</p>
<pre><code>  dd # 删除一行
  u # 版本回退</code></pre>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Django/" rel="tag"># Django</a>
              <a href="/tags/%E5%90%8E%E7%AB%AF/" rel="tag"># 后端</a>
              <a href="/tags/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/" rel="tag"># 环境部署</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/03/21/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" rel="prev" title="设计模式之单例模式">
      <i class="fa fa-chevron-left"></i> 设计模式之单例模式
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/03/31/%E8%80%81%E7%94%9F%E5%B8%B8%E8%B0%88%E2%80%94%E2%80%94activity%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F/" rel="next" title="老生常谈——activity生命周期">
      老生常谈——activity生命周期 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux-django-nginx-uwsgi-mysql%E9%83%A8%E7%BD%B2"><span class="nav-number">1.</span> <span class="nav-text">Linux+django+nginx+uwsgi+mysql部署</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-mac%E7%BB%88%E7%AB%AF%E7%99%BB%E5%BD%95%E6%9C%8D%E5%8A%A1%E5%99%A8ubuntu%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.1.</span> <span class="nav-text">1.mac终端登录服务器ubuntu系统</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87ssh%E8%BF%9E%E6%8E%A5"><span class="nav-number">1.1.0.1.</span> <span class="nav-text">通过ssh连接</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%A3%85python%E7%8E%AF%E5%A2%83"><span class="nav-number">1.2.</span> <span class="nav-text">2. 装python环境</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E8%BD%AF%E4%BB%B6%E5%88%97%E8%A1%A8%E5%92%8C%E6%9C%AC%E5%9C%B0%E8%BD%AF%E4%BB%B6"><span class="nav-number">1.2.0.1.</span> <span class="nav-text">更新软件列表和本地软件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%A4%9A%E7%89%88%E6%9C%ACpython"><span class="nav-number">1.2.0.2.</span> <span class="nav-text">安装多版本python</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="nav-number">1.3.</span> <span class="nav-text">3.配置虚拟环境</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="nav-number">1.3.0.1.</span> <span class="nav-text">安装虚拟环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E6%88%91%E4%BB%AC%E7%9A%84%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="nav-number">1.3.0.2.</span> <span class="nav-text">管理我们的虚拟环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="nav-number">1.3.0.3.</span> <span class="nav-text">创建虚拟环境</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E7%94%A8PyCharm%E5%B0%86%E9%A1%B9%E7%9B%AE%E4%B8%8A%E4%BC%A0%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E6%9C%AC%E5%9C%B0%EF%BC%89"><span class="nav-number">1.4.</span> <span class="nav-text">4.用PyCharm将项目上传到服务器（本地）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-uWSGI%E5%AE%89%E8%A3%85%E5%8F%8A%E9%85%8D%E7%BD%AE"><span class="nav-number">1.5.</span> <span class="nav-text">5.uWSGI安装及配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E9%85%8D%E7%BD%AEuWSGI"><span class="nav-number">1.6.</span> <span class="nav-text">6.配置uWSGI</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%93%E9%80%9AuWSGI%E5%92%8CPython"><span class="nav-number">1.6.0.1.</span> <span class="nav-text">打通uWSGI和Python</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%93%E9%80%9AuWSGI%E5%92%8CDjango"><span class="nav-number">1.6.0.2.</span> <span class="nav-text">打通uWSGI和Django</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E9%85%8D%E7%BD%AEnginx"><span class="nav-number">1.7.</span> <span class="nav-text">7.配置nginx</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">1.7.0.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEngxin"><span class="nav-number">1.7.0.2.</span> <span class="nav-text">配置ngxin</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-Nginx-uWSGI-Django"><span class="nav-number">1.8.</span> <span class="nav-text">8.Nginx+uWSGI+Django</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95Nginx"><span class="nav-number">1.8.0.1.</span> <span class="nav-text">测试Nginx</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95uWSGI"><span class="nav-number">1.8.0.2.</span> <span class="nav-text">测试uWSGI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8UNIX-socket%E5%8F%96%E4%BB%A3TCP-port"><span class="nav-number">1.8.0.3.</span> <span class="nav-text">用UNIX socket取代TCP port</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-%E9%85%8D%E7%BD%AEMySql"><span class="nav-number">1.9.</span> <span class="nav-text">9.配置MySql</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">1.9.0.1.</span> <span class="nav-text">初始化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEmysql%E8%83%BD%E8%A2%AB%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE"><span class="nav-number">1.9.0.2.</span> <span class="nav-text">配置mysql能被远程访问</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96"><span class="nav-number">1.10.</span> <span class="nav-text">其他</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">fhyPayaso</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fhyPayaso</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
